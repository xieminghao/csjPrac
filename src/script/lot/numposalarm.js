function Alarm(a){this.lot=a,this.isRun=!1,this.posCount=0,this.sound=!0,this.result=[],this.chk_cars=[],this.chk_pos=[],this.total=2,this.dataInit=!1,this.lastPeriod=0,this.init=function(){var a,b;for(this.result=new Array(10),a=0;10>a;a++)this.result[a]=[];this.total=~~$("#s_total").val(),b=this.chk_cars.slice(),$.get("/"+this.lot+"/ajax",{ajaxHandler:"gethistory",count:this.total-1},function(a){var c,d,e,f,g,h;if(a&&a.datas&&a.datas.length==alarm.total-1)for(c=0;c<alarm.total-1&&!(b.length<=0);c++)for(d=a.datas[c],e=d.numbers.split(","),f=0;f<b.length;f++){for(g=!1,h=0;h<alarm.chk_pos.length;h++)if(e[alarm.chk_pos[h]]==b[f]){alarm.result[b[f]-1].push({period:d.period,pos:posNames[alarm.chk_pos[h]]}),g=!0;break}g||(b.splice(f,1),f--)}alarm.dataInit=!0,alarm.showResult()},"json")},this.process=function(){this.isRun&&this.dataInit&&$.get("/"+this.lot+"/ajax",{ajaxHandler:"get"+this.lot+"awarddata",t:Math.random()},function(a){var c,d,e,f,g,b=a.current.periodNumber;if(alarm.lastPeriod==b)return setTimeout(function(){alarm.process()},5e3),void 0;for(alarm.lastPeriod=b,c=alarm.chk_cars.slice(),d=a.current.awardNumbers.split(","),e=0;e<c.length;e++){for(f=!1,g=0;g<alarm.chk_pos.length;g++)if(d[alarm.chk_pos[g]]==c[e]){alarm.result[c[e]-1].unshift({period:b,pos:posNames[alarm.chk_pos[g]]}),f=!0;break}f||(alarm.result[c[e]-1]=[],c.splice(e,1),e--)}alarm.showResult()},"json")},this.showResult=function(){var c,d,e,f,a=$(".nda_block ul li table"),b=!1;if(null!=this.result&&10==this.result.length)for(c=0;10>c;c++)if(d=this.result[c],e=$(a[c]),e.find("tr[class!=head]").remove(),null!=d&&d.length>=this.total){for(d.length>10&&d.splice(10,d.length-10),e.addClass("nda_dataTable"),f=0;f<d.length;f++)e.append("<tr><td>"+d[f].period+"</td><td>"+d[f].pos+"</td></tr>");b=!0}else e.removeClass("nda_dataTable"),e.append('<tr><td colspan="2"  class="nda_table_text">该号码没有符合的报警条件</td></tr>');b&&this.soundAlarm()},this.checkRun=function(){return this.isRun},this.showError=function(a){$.auto_alert({cont:a})},this.start=function(){var c,d,a=$("#c_car i[class*=nda_selected]"),b=$("#c_pos i[class*=nda_selected]");if(!(a.length<=0||b.length<=0)){for(this.chk_cars=[],this.chk_pos=[],c=b.length-1;c>-1;c--)this.chk_pos.push(~~$(b[c]).attr("data-pos"));for(d=a.length-1;d>-1;d--)this.chk_cars.push(~~$(a[d]).attr("data-car"));if(this.chk_cars.length<=0||this.chk_pos.length<=0)return this.showError("操作失败，请刷新页面重试！"),this.isRun=!1,void 0;this.showError("报警已开启！"),this.isRun=!0,this.init()}},this.stop=function(){this.isRun=!1,this.dataInit=!1,this.showError("报警已关闭！")},this.soundAlarm=function(){var a,b;try{this.sound&&(a=$("#duAlarm"),a[0].load?(a[0].load(),a[0].play()):(b=$("#duAlarm").attr("src"),a.length&&a.remove(),a=document.createElement("bgsound"),a.id="duAlarm",a.src=b,a.loop=1,$(a).appendTo(document.body)))}catch(c){}}}var posNames=["冠军","亚军","第三名","第四名","第五名","第六名","第七名","第八名","第九名","第十名"];$(function(){function a(){var a=$("#c_car i[class*=nda_selected]"),b=$("#c_pos i[class*=nda_selected]");a.length>=1&&b.length>=1?$("#star_btn").addClass("hover"):$("#star_btn").removeClass("hover")}$("#sound_btn").bind("click",function(){$(this).attr("class").indexOf("nda_selected")>0?($(this).removeClass("nda_selected"),alarm.sound=!1):(alarm.sound=!0,$(this).addClass("nda_selected"))}),$("#c_car i").bind("click",function(){alarm.checkRun()||($(this).attr("class").indexOf("nda_selected")>0?$(this).removeClass("nda_selected"):$(this).addClass("nda_selected"),a())}),$("#c_pos i").bind("click",function(){if(!alarm.checkRun()){if($(this).attr("class").indexOf("nda_selected")>0)$(this).removeClass("nda_selected"),alarm.posCount-=1;else{if(alarm.posCount>=8)return alarm.showError("最多选择8个报警位置！"),void 0;$(this).addClass("nda_selected"),alarm.posCount+=1}a()}}),$("#select_all_cars").bind("click",function(){alarm.checkRun()||($("#c_car i").addClass("nda_selected"),a())}),$("#clear_pos").bind("click",function(){alarm.checkRun()||(alarm.posCount=0,$("#c_pos i").removeClass("nda_selected"),a())}),$("#clear_cars").bind("click",function(){alarm.checkRun()||($("#c_car i").removeClass("nda_selected"),a())}),$("#star_btn").bind("click",function(){alarm.isRun?(alarm.stop(),$(this).removeClass("active").text("开启报警"),$("#s_total").attr("disabled",!1),$("#c_car i,#c_pos i,#select_all_cars,#clear_cars,#clear_pos").css({cursor:"pointer"})):(alarm.start(),alarm.isRun&&($("#s_total").attr("disabled",!0),$(".nda_block ul li table").removeClass("nda_dataTable"),$(this).addClass("active").text("关闭报警"),$("#c_car i,#c_pos i,#select_all_cars,#clear_cars,#clear_pos").css({cursor:"default"})))})});